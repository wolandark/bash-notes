<!DOCTYPE HTML>
<html lang="ir" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Minesweep - Bash Notes</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../ANSI.html"><strong aria-hidden="true">1.</strong> ANSI Sequences</a></li><li class="chapter-item expanded "><a href="../../HelloWorld.html"><strong aria-hidden="true">2.</strong> Creative Hello World </a></li><li class="chapter-item expanded "><a href="../../Minesweep/Transcript/Minesweep.html" class="active"><strong aria-hidden="true">3.</strong> Minesweep</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Bash Notes</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div dir="rtl">بیاین بازی ساده زیر رو بسازیم</div>
<p><img src="../_resources/demo.gif" alt="demo.gif" /></p>
<div dir="rtl">در ابتدا به سایز ترمینال نیاز داریم</div>
<pre><code class="language-bash">cols=$(tput cols)
lines=$(tput lines)

echo $cols
echo $lines
</code></pre>
<div dir="rtl">تی‌پات یک پکیجیه که با ncurses نصب می‌شه و روی اکثر سیستم‌ها هست</div>
<p><img src="../_resources/ec017c947f2f156f59e08bb68297aef7.png" alt="ec017c947f2f156f59e08bb68297aef7.png" /></p>
<div dir="rtl">دومین کارمون اینه که محیط یا همون فیلد بازی رو مشخص کنیم.  </div>
<div dir="rtl">خب برای این کار باید بتونیم یک کاراکتری رو توی تمام خونه ‌های ترمینال چاپ کنیم.</div>
<pre><code class="language-bash">cols=$(tput cols)
lines=$(tput lines)

for ((i=0; i &lt; cols; i++)); do
    printf '-'
    for ((j=0; j &lt; lines j++)); do
        printf '-'
    done
done
</code></pre>
<p><img src="../_resources/44dbb3c62a2171a4893f8b702c21398a.png" alt="44dbb3c62a2171a4893f8b702c21398a.png" /></p>
<div dir="rtl"><div dir="rtl">از اونجایی که لاین‌ها دارن یکم اسکرول می‌دن و ما این پایین ترمینالو می‌خوایم واسه اینکه بعدا میزان جون و تعداد حدس ‌های درست رو نشون بدیم، تعداد لاین‌ها رو کم می‌کنیم</div></div>
<pre><code class="language-bash">cols=$(tput cols)
lines=$(tput lines)

for ((i=0; i &lt; cols; i++)); do
    printf '-'
    for ((j=0; j &lt; lines- 4; j++)); do &lt;---- CHANGE HERE
        printf '-'
    done
done
</code></pre>
<div dir="rtl">در مرحله بعدی باید بتونیم یه سری ستاره جاهای رندم چاپ کنیم</div>
<div dir="rtl">یه فایل تست باز می کنیم</div>
<pre><code class="language-bash">cols=$(tput cols)
lines=$(tput lines)

num_stars=20

declare -A star_positions

for ((n=0; n&lt;num_stars; n++)); do
    rand_col=$((RANDOM % cols))
    rand_line=$((RANDOM % (lines - 4)))
    star_positions["$rand_line,$rand_col"]=1
done

for ((i=0; i &lt; lines - 4; i++)); do
    for ((j=0; j &lt; cols; j++)); do
        if [[ ${star_positions["$i,$j"]} ]]; then
            tput cup "$i" "$j"
            printf '*'
        fi
    done
done

tput cup "$lines" 0
</code></pre>
<p><img src="../_resources/b17844fb38b0388a70eaedbbeb2b1b6e.png" alt="b17844fb38b0388a70eaedbbeb2b1b6e.png" /></p>
<div dir="rtl">
یک آرایه اسوشیتیو (آرایه کلید-مقدار) به نام `star_positions` ایجاد می‌کنیم.از این آرایه برای ذخیره کردن ستون و سطر رندم استفاده می‌کنیم.پس از آن در لوپ اول، برای هر ستاره، موقعیت تصادفن را در ترمینال تعیین می‌کنیم. موقعیت ستاره در آرایه `star_positions` با کلید `"$rand_line,$rand_col"` ذخیره می‌شود. بعدا یک تابع move cursor میسازیم ولی فعلا با تی‌پات کارمونو راه میندازیم</div>
<div dir="rtl">
اگه بخوایم هم ستاره چاپ کنیم و هم خط فاصله میتونیم به سبک کد قبلی برگردیم.  </div>
<br>
<div dir="rtl">
حالا که دیدیم چطور می‌شه در جاهای رندم کاراکتری رو چاپ کرد،به شکل زیر عمل می‌کنیم.
</div>
<pre><code class="language-bash">for ((i=0; i &lt; lines - 4; i++)); do
    for ((j=0; j &lt; cols; j++)); do
        if [[ ${star_positions["$i,$j"]} ]]; then
            printf '*'
        else
            printf '-'
        fi
    done
    printf '\n'
done
</code></pre>
<div dir="rtl">پس تا اینجا کد ما به این شکل میشه</div>
<pre><code class="language-bash">cols=$(tput cols)
lines=$(tput lines)

num_stars=20

declare -A star_positions

for ((n=0; n&lt;num_stars; n++)); do
	rand_col=$((RANDOM % cols))
	rand_line=$((RANDOM % (lines - 4)))
	star_positions["$rand_line,$rand_col"]=1
done

for ((i=0; i &lt; lines - 4; i++)); do
    for ((j=0; j &lt; cols; j++)); do
        if [[ ${star_positions["$i,$j"]} ]]; then
            printf '*'
        else
            printf '-'
        fi
    done
    printf '\n'
done
</code></pre>
<p><img src="../_resources/45a129a9b27b87ffdde40b4563203638.png" alt="45a129a9b27b87ffdde40b4563203638.png" /></p>
<div dir="rtl">حالا خوبه که مکان مین‌هارو پنهان کنیم و واسه این کار تمام ترمینال رو با کاراکتر یونیکد بلوک پر می‌کنیم</div>
<div dir="rtl">برای وارد کردن کاراکتر یونیکد توی ویم در حالت insert به این شکل عمل می‌کنیم`C-v u2588`</div>
<div dir="rtl">یعنی کنترل+v و بعد کد یونیکد رو وارد می‌کنیم.</div>
<pre><code class="language-bash">cols=$(tput cols)
lines=$(tput lines)

num_stars=20

declare -A star_positions

for ((n=0; n&lt;num_stars; n++)); do
	rand_col=$((RANDOM % cols))
	rand_line=$((RANDOM % (lines - 4)))
	star_positions["$rand_line,$rand_col"]=1
done

for ((i=0; i &lt; lines - 4; i++)); do
    for ((j=0; j &lt; cols; j++)); do
        if [[ ${star_positions["$i,$j"]} ]]; then
            printf '█'
        else
            printf '█'
        fi
    done
    printf '\n'
done
</code></pre>
<div dir="rtl">تا اینجای کار ما یک زمین بازی درست کردیم</div>
<p><img src="../_resources/cb5342614cf7b2fc15e9902819a5f642.png" alt="cb5342614cf7b2fc15e9902819a5f642.png" /></p>
<div dir="rtl">حالا وقتشه که رنگ زمین بازی‌مون رو عوض کنیم</div>
<p><code>printf '\033[1;33m█\033[0m'</code></p>
<div dir="rtl">با استفاده از کد انسی بالا  رنگ پیش زمینه ترمینال رو زرد می‌کنیم و بلوک هارو چاپ می‌کنیم</div>
<p><img src="../_resources/2ba36fd870fcc526c2cc394273263dbd.png" alt="2ba36fd870fcc526c2cc394273263dbd.png" /></p>
<div dir="rtl">
حالا باید راهی برای آزادانه حرکت دادن نشان‌گر پیدا کنیم. با جستجو در  man 1 stty  با قابلیت raw آشنا می‌شیم. همچنین با استفاده از دستور   read  می‌تونیم کلید های ورودی را بخونیم
</div>
<pre><code class="language-bash"># Enable raw input mode
stty -raw

# Clear the screen
clear
# Infinite loop to process key presses
while true; do
    # Read the input
    read -rsn1 key
    
    # Check for escape sequences
    if [[ $key == $'\x1b' ]]; then
        # Read the next two bytes
        read -rsn2 -t 0.1 key
        
        case "$key" in
            "[A") # Up arrow
                echo -ne "\033[A"
                ;;
            "[B") # Down arrow
                echo -ne "\033[B"
                ;;
            "[C") # Right arrow
                echo -ne "\033[C"
                ;;
            "[D") # Left arrow
                echo -ne "\033[D"
                ;;
        esac
    fi
done

# Reset terminal settings when done (not reached in this loop)
stty echo icanon
</code></pre>
<div dir="rtl">
قطعه‌ی بالا به‌خوبی کامنت شده تا متوجه بشید هر قسمت چه کاری انجام می‌ده، اما به جزئیات بیشتری نمی‌پردازیم. اگه علاقه‌مند هستید، می‌تونید برای اطلاعات بیشتر به `man stty` و `man read` مراجعه کنید.
<p>در سطح بعدی باید روشی پیدا کنیم تا بتونیم موقعیت ستاره‌های تصادفی رو ردیابی کنیم و بعد در صورتی که کاربر کلید Enter رو روی اون‌ها فشار داد، اون‌ها رو با چیزی جایگزین کنیم.</p>
<p>اما ابتدا کد خودمون رو سازماندهی می‌کنیم. تااینجا به یک تابع draw_grid، تابع replace_stars و یک حلقه‌ی اصلی بازی (game_loop) نیاز داریم، که توی اون حالت raw را فعال می‌کنیم. همچنین یک تابع move_cursor و متغیرهای cursor_row و cursor_col رو تعریف می‌کنیم تا حرکت مکان‌نما رو آسون‌تر مدیریت کنیم. این کار به ما اجازه می‌ده کدهای ANSI که مکان‌نما را در کد بالا جابجا می‌کردن، حذف کنیم.</p>
</div>
<pre><code class="language-bash">cursor_row=$((lines - 5))
cursor_col=0

move_cursor() {
    echo -ne "\033[${1};${2}H"
}

draw_grid() {
	clear
	for ((i=0; i &lt; lines - 4; i++)); do
		for ((j=0; j &lt; cols; j++)); do
			if [[ ${star_positions["$i,$j"]} ]]; then
				printf '\033[1;33m█\033[0m'
			else
				printf '\033[1;33m█\033[0m'
			fi
		done
		printf '\n'
	done
}

make_stars() {
	for ((n=0; n&lt;num_stars; n++)); do
		rand_col=$((RANDOM % cols))
		rand_line=$((RANDOM % (lines - 4)))
		star_positions["$rand_line,$rand_col"]=1
	done
}

game_loop() {
	while true; do
		
		move_cursor $((cursor_row+1)) $((cursor_col+1))

		read -rsn1 key

		if [[ $key == $'\x1b' ]]; then
			read -rsn2 -t 0.1 key

			case "$key" in
				"[A") # Up arrow
					((cursor_row--))
					((cursor_row &lt; 0)) &amp;&amp; cursor_row=0
					;;
				"[B") # Down arrow
					((cursor_row++))
					((cursor_row &gt; lines - 5)) &amp;&amp; cursor_row=$((lines - 5))
					;;
				"[C") # Right arrow
					((cursor_col++))
					((cursor_col &gt;= cols)) &amp;&amp; cursor_col=$((cols - 1))
					;;
				"[D") # Left arrow
					((cursor_col--))
					((cursor_col &lt; 0)) &amp;&amp; cursor_col=0
					;;
			esac
		fi
	done
}
</code></pre>
<div dir="rtl">
جالا باید برخورد با ستاره‌ها را پیاده‌سازی کنیم. باید بتونیم وقتی کاربر کلید Enter رو روی ستاره‌ها فشار می‌ده، اون‌ها رو با کاراکتر دیگه‌ای جایگزین کنیم.
</div>
<pre><code class="language-bash">replace_star() {
    if [[ ${star_positions["$cursor_row,$cursor_col"]} ]]; then
        # Clear the star and replace it with '#'
        star_positions["$cursor_row,$cursor_col"]=0
        move_cursor $((cursor_row+1)) $((cursor_col+1))
        echo -n "#"
        move_cursor $((cursor_row+1)) $((cursor_col+1))
    fi
}
</code></pre>
<div dir="rtl">با هم</div>
<pre><code class="language-bash">cols=$(tput cols)
lines=$(tput lines)
num_stars=10000
cursor_row=$((lines - 5))
cursor_col=0

move_cursor() {
	echo -ne "\033[${1};${2}H"
}

draw_grid() {
	clear
	for ((i=0; i &lt; lines - 4; i++)); do
		for ((j=0; j &lt; cols; j++)); do
			if [[ ${star_positions["$i,$j"]} ]]; then
				printf '\033[1;33m█\033[0m'
			else
				printf '\033[1;33m█\033[0m'
			fi
		done
		printf '\n'
	done
}

make_stars() {
	for ((n=0; n&lt;num_stars; n++)); do
		rand_col=$((RANDOM % cols))
		rand_line=$((RANDOM % (lines - 4)))
		star_positions["$rand_line,$rand_col"]=1
	done
}

replace_star() {
	if [[ ${star_positions["$cursor_row,$cursor_col"]} ]]; then
		# Clear the star and replace it with '#'
		star_positions["$cursor_row,$cursor_col"]=0
		move_cursor $((cursor_row+1)) $((cursor_col+1))
		echo -n "#"
		move_cursor $((cursor_row+1)) $((cursor_col+1))
	fi
}

game_loop() {
	while true; do

		move_cursor $((cursor_row+1)) $((cursor_col+1))
		read -rsn1 key

		if [[ $key == "" ]]; then
			replace_star

		fi
		if [[ $key == $'\x1b' ]]; then
			read -rsn2 -t 0.1 key

			case "$key" in
				"[A") # Up arrow
					((cursor_row--))
					((cursor_row &lt; 0)) &amp;&amp; cursor_row=0
					;;
				"[B") # Down arrow
					((cursor_row++))
					((cursor_row &gt; lines - 5)) &amp;&amp; cursor_row=$((lines - 5))
					;;
				"[C") # Right arrow
					((cursor_col++))
					((cursor_col &gt;= cols)) &amp;&amp; cursor_col=$((cols - 1))
					;;
				"[D") # Left arrow
					((cursor_col--))
					((cursor_col &lt; 0)) &amp;&amp; cursor_col=0
					;;
			esac
		fi
	done
}

function main() {
	draw_grid
	make_stars
	game_loop
}
main
</code></pre>
<div dir="rtl">
حالا وقتش رسیده که انفجارها رو بسازیم. برای این کار، تابع replace_star خودمون رو اصلاح می‌کنیم.
</div>
<pre><code class="language-bash">replace_star() {
	if [[ ${star_positions["$cursor_row,$cursor_col"]} ]]; then
		star_positions["$cursor_row,$cursor_col"]=0

		size=$((RANDOM % 5 + 3))

		local start_row=$((cursor_row - size / 2))
		local start_col=$((cursor_col - size / 2))

		for ((i=0; i&lt;size; i++)); do
			move_cursor $((start_row + i)) $start_col
			printf '\033[1;31m'
			for ((j=0; j&lt;size; j++)); do
				echo -n '█'
			done
			printf '\033[0m'
		done

		move_cursor $cursor_row $cursor_col
		echo -e '\033[1;31m#\033[0m'  # Center character in red
		move_cursor $((start_row + size + 1)) $start_col
	else
		move_cursor $((cursor_row+1)) $((cursor_col+1))
		printf '\033[1;36m█\033[0m'
	fi
}
</code></pre>
<p><img src="../_resources/286d1c0b7161dcf0edaa0572fa01a5f1.png" alt="286d1c0b7161dcf0edaa0572fa01a5f1.png" /></p>
<div dir="rtl">
تقریباً کارمون تموم شده. تنها کاری که باید انجام بدیم اینه که متغیرهایی برای سلامتی و مرحله اضافه کنیم و منطق‌های کوچکی برای زمانی که کاربر برنده یا بازنده شده، اضافه کنیم. چاپ اطلاعات در پایین ترمینال مثل قبل آسونه و می‌تونیم از تابع move_cursor خودمون استفاده کنیم.
</div>
<pre><code class="language-bash">round=0;
hp=5;
win=0;
</code></pre>
<div dir="rtl">و مکان مشخصی برای پیام جون</div>
<pre><code class="language-bash">health_msg=$((lines - 2))

move_cursor $health_msg 0 
printf "HP: $hp"

</code></pre>
<div dir="rtl">دو عملیات ریاضی بعد انفجار اضافه می‌کنیم</div>
<pre><code class="language-bash">((round++))
((hp--))
</code></pre>
<div dir="rtl">
به این شکل می‌تونیم`round` رو کم کنیم و`hp` زیاد کنیم  </div>
<div dir="rtl">
باقی کد هم توی یک لاجیک ساده wrap می‌کنیم</div>
<pre><code class="language-bash">if [[ $round -ge 6 ]]; then
	tput reset
	figlet "GAME OVER"
	exit 0
else
	((win++))
fi
</code></pre>
<div dir="rtl">
و کد زیر رو قبل` fi `بالا قرار می دیم
</div>
<pre><code class="language-bash">if [[ $win -eq 20 ]]; then
	tput reset
	echo "Round Cleared!"
	exit 0
fi
</code></pre>
<div dir="rtl">سپس به کاربر خوش‌امد می‌گیم</div>
<pre><code class="language-bash">center_col=$((cols / 2 - 25))
center_line=$((lines / 2 - 2))

move_cursor $center_line $center_col 
printf "Survive 20 Guesses, or DIE after 5 explosions"
sleep 2;
</code></pre>
<div dir="rtl">و برای بار آخر کد رو ریفاکتور می‌کنیم</div>
<pre><code class="language-bash">#!/usr/bin/env bash

cols=$(tput cols)
lines=$(tput lines)
center_col=$((cols / 2 - 25))
center_line=$((lines / 2 - 2))
cursor_row=$((lines - 5))
cursor_col=0
round=0
hp=5
win=0
health_msg=$((lines - 2))
num_stars=10000

move_cursor() {
    echo -ne "\033[${1};${2}H"
}

initialize_screen() {
    move_cursor $center_line $center_col
    printf "Survive 20 Guesses, or DIE after 5 explosions"
    sleep 2
    clear
    move_cursor $health_msg 0
    printf "HP: $hp"
}

generate_star_positions() {
    declare -gA star_positions
    for ((n=0; n&lt;num_stars; n++)); do
        rand_col=$((RANDOM % cols))
        rand_line=$((RANDOM % (lines - 4)))
        star_positions["$rand_line,$rand_col"]=1
    done
}

draw_grid() {
    clear
    for ((i=0; i &lt; lines - 4; i++)); do
        for ((j=0; j &lt; cols; j++)); do
            if [[ ${star_positions["$i,$j"]} ]]; then
                printf '\033[1;33m█\033[0m'
            else
                printf '\033[1;33m█\033[0m'
            fi
        done
        printf '\n'
    done
}

replace_star() {
    if [[ ${star_positions["$cursor_row,$cursor_col"]} ]]; then
        star_positions["$cursor_row,$cursor_col"]=0
        size=$((RANDOM % 5 + 3))
        local start_row=$((cursor_row - size / 2))
        local start_col=$((cursor_col - size / 2))
        
        for ((i=0; i&lt;size; i++)); do
            move_cursor $((start_row + i)) $start_col
            printf '\033[1;31m'
            for ((j=0; j&lt;size; j++)); do
                echo -n '█'
            done
            printf '\033[0m'
        done
        
        ((round++))
        ((hp--))
        move_cursor $cursor_row $cursor_col
        echo -e '\033[1;31m#\033[0m'
        move_cursor $((start_row + size + 1)) $start_col

        if [[ $round -ge 5 ]]; then
            tput reset
            figlet "GAME OVER"
            exit 0
        else
            move_cursor 1 1
            printf '\033[1;37mYou Survive The Explosion!\033[0m'
            sleep 1
            move_cursor 1 1
            size=26
            printf '\033[1;33m'
            for ((i=0; i&lt;size; i++)); do
                echo -n '█'
            done
            printf '\033[0m'
            round_msg=$((lines - 3))
            move_cursor "$round_msg" 0
            echo "Round: $round / 5"
            move_cursor $health_msg 0
            printf "HP: $hp"
        fi
    else
        move_cursor $((cursor_row+1)) $((cursor_col+1))
        printf '\033[1;36m█\033[0m'
        ((win++))
        win_msg=$((lines - 1))
        move_cursor $win_msg 0
        printf "Win: $win"

        if [[ $win -eq 20 ]]; then
            tput reset
            figlet "Round Cleared!"
            exit 0
        fi
    fi
}

game_loop() {
    stty -echo -icanon time 0 min 0
    while true; do
        move_cursor $((cursor_row+1)) $((cursor_col+1))
        read -rsn1 key
        if [[ $key == "" ]]; then
            replace_star
        fi
        if [[ $key == $'\x1b' ]]; then
            read -rsn2 -t 0.1 key
            case "$key" in
                "[A") ((cursor_row--)); ((cursor_row &lt; 0)) &amp;&amp; cursor_row=0 ;;
                "[B") ((cursor_row++)); ((cursor_row &gt; lines - 5)) &amp;&amp; cursor_row=$((lines - 5)) ;;
                "[C") ((cursor_col++)); ((cursor_col &gt;= cols)) &amp;&amp; cursor_col=$((cols - 1)) ;;
                "[D") ((cursor_col--)); ((cursor_col &lt; 0)) &amp;&amp; cursor_col=0 ;;
            esac
        fi
    done
    stty echo icanon
}

initialize_screen
generate_star_positions
draw_grid
game_loop
</code></pre>
<p>و به همین سادگی بازی ما تموم شد. قطعا جای خیلی زیادی برای ارتقای این بازی وجود داره، اما با اطلاعاتی که توی این نوشته یاد گرفتید، می‌تونین خودتون بی‌نهایت این کد رو ارتفا بدین.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../HelloWorld.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../HelloWorld.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
